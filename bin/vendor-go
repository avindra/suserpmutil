#!/usr/bin/bash

rm vendor*gz
file=$(ls ./*gz)
foldername=$(tar --exclude="*/*" -tf "$file")

destdir="$(mktemp -d /tmp/revendor.XXXXXXXXXX)"

cp "$file" "$destdir"

pushd "$destdir"

tar xf "$file"
pushd "$foldername"

# https://stackoverflow.com/a/58512507/270302
go mod tidy
go mod vendor
target="$destdir/vendor.tar.xz"

time tar -cf - vendor/ |  xz -2 -c - > "$target"

popd
popd

ls -lh "$target"

echo "copying now!"
cp "$target" .

